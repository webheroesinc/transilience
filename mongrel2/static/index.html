<!DOCTYPE html>
<html>
    <head>
        <title>Mongrel2 Transceiver Demo</title>

	<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css" />
	<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/styles/default.min.css">
	<style type="text/css">
	    body { font-size: 16px; }
	</style>
    </head>
    <body>
	<div class="container">
	    <div class="page-header">
		<h1>Mongrel2 Transceiver Demo</h1>
	    </div>

	    <div class="row">
		<br>
		<div class="col-md-6">
		    <p>This is a demo of how easy it is to handle WebSocket connection using
		    Mongrel2 Transceiver.  Type a message in the text box and it will be broadcast
		    to all the current WebSocket connections.</p>
		    
		    <hr>
		    <p><big>View the Python handler code below to see how simple, clean and
		    beautiful <code>mongrel2_transceiver</code> is!</big></p>
		    <hr>

		    <p>To get started the <code>Tranceiver</code> class only requires the
		    information needed to connect to the Mongrel2 server <i>(sender ID, PUSH address
		    and SUB address)</i>.</p>
		</div>
		<div class="col-md-6">
		    <h3>WebSocket Connection <span id="websocket-status" class="label label-default">status</span></h3>
		    <br>
		    <form id="send" class="form-inline">
			<div class="col-xs-8 form-group">
			    <input type="text" id="msg"
				   class="form-control" placeholder="Message"
				   style="width: 100%;">
			</div>
			<div class="col-xs-4 form-group">
			    <button type="submit" class="btn btn-primary">Send</button>
			</div>
		    </form>
		    <br><br>

		    <h2>Open WebSocket Chat</h2>
		    <pre id="messages"></pre>
		</div>
		<br>
	    </div>

	    <hr>

	    <div class="col-md-offset-1 col-md-10">
		<div class="panel panel-default">
		    <div class="panel-heading">
			<strong>demo.py</strong>
			(<a href="http://demo.mongrel2-transceiver.com//demo.py" target="_blank">http://demo.mongrel2-transceiver.com/demo.py</a>)
		    </div>
		    <div class="panel-body">
			<pre id="demo-code" class="lang-python"></pre>
		    </div>
		</div>
	    </div>
	</div>

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
	<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/highlight.min.js"></script>
	<script type="text/javascript">
	    (function(window) {
	        var host	= window.location.host;
	        var url		= 'http://'+host+'/';
	        var api		= 'ws://'+host+'/api';
		var ws_status	= $('#websocket-status');
		var demo_code	= $('#demo-code');
		var messages	= $('#messages');
		var send	= $('#send');
		var msg		= $('#msg');

		$.ajax({
		    url: url+'demo.py',
		    success: function(html) {
			demo_code.text(html);
			hljs.highlightBlock(demo_code.get(0));
		    }
		});

		send.on('submit', function(e) {
		    e.preventDefault();
		    ws.send(msg.val());
		    msg.val('');
		});

		window.ws	= new WebSocket(api);
		ws.onmessage	= function(m) {
		    messages.append(m.data)
		}
		ws.onopen	= function() {
		    ws_status.prop('class', 'label label-success');
		}
		ws.onclose	= function() {
		    ws_status.prop('class', 'label label-danger');
		}
	    })(window);
	</script>
    </body>
</html>
